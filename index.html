<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <title>Tap Coin Mini App</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

    <!-- Telegram WebApp SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <style>
        :root {
            --bg-main: radial-gradient(circle at top, #050016 0, #02000a 45%, #000 100%);

            --accent: #5fa8ff;
            --accent-soft: #90c5ff;
            --accent-deep: #1f4fb5;
            --green: #22c55e;

            --text-main: #f9fbff;
            --text-muted: #a1a4c0;

            --glass-bg: rgba(11, 16, 40, 0.48);
            --glass-bg-soft: rgba(16, 20, 46, 0.54);
            --glass-border: rgba(255, 255, 255, 0.22);
            --glass-border-soft: rgba(255, 255, 255, 0.16);

            --danger: #ff4b6a;
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", Roboto, sans-serif;
            background: #000;
            color: var(--text-main);
        }

        body {
            display: flex;
            justify-content: center;
            align-items: stretch;
            overflow: hidden;
        }

        /* SNOW CANVAS (iOS Weather style) */
        #snowCanvas {
            position: fixed;
            inset: 0;
            z-index: 0;
            pointer-events: none;
        }

        #app {
            position: relative;
            width: 100%;
            max-width: 480px;
            height: 100vh;
            background: var(--bg-main);
            color: var(--text-main);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            z-index: 1;
        }

        /* COMMON GLASS CARD BASE */
        .glass-card {
            position: relative;
            border-radius: 20px;
            background: linear-gradient(
                135deg,
                rgba(255, 255, 255, 0.14),
                rgba(255, 255, 255, 0.02)
            );
            background-color: rgba(6, 10, 32, 0.75);
            border: 1px solid var(--glass-border);
            box-shadow:
                0 18px 40px rgba(0, 0, 0, 0.75),
                0 0 0 1px rgba(1, 4, 18, 0.95);
            backdrop-filter: blur(24px) saturate(160%);
            -webkit-backdrop-filter: blur(24px) saturate(160%);
            overflow: hidden;
        }

        .glass-card::after {
            content: "";
            position: absolute;
            inset: 0;
            border-radius: inherit;
            background:
                radial-gradient(circle at 15% 0, rgba(255, 255, 255, 0.32), transparent 60%);
            mix-blend-mode: screen;
            pointer-events: none;
            opacity: 0.9;
        }

        /* SCROLL CONTAINERS */
        .tab-page {
            position: absolute;
            inset: 0 0 80px 0; /* bottom reserved for nav */
            padding: 10px 16px 12px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            display: none;
        }

        .tab-page.active {
            display: block;
            animation: fadeInScale 260ms ease-out;
        }

        @keyframes fadeInScale {
            0% {
                opacity: 0;
                transform: translateY(6px) scale(0.99);
            }
            100% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .section-title {
            font-size: 18px;
            font-weight: 700;
            margin: 4px 0 4px;
        }

        .section-subtitle {
            font-size: 12px;
            color: var(--text-muted);
            margin-bottom: 10px;
        }

        /* HEADER / BALANCE (HOME) */
        .top-banner {
            margin: 6px 0 6px;
            padding: 10px 16px;
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.26);
            background:
                linear-gradient(135deg, rgba(126, 165, 255, 0.3), rgba(25, 32, 80, 0.95));
            box-shadow:
                0 18px 42px rgba(0, 0, 0, 0.85),
                0 0 0 1px rgba(1, 4, 18, 1);
            backdrop-filter: blur(26px) saturate(170%);
            -webkit-backdrop-filter: blur(26px) saturate(170%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 14px;
            letter-spacing: 0.06em;
            text-transform: uppercase;
        }

        .top-banner::after {
            content: "";
            position: absolute;
            inset: 0;
            border-radius: inherit;
            background: radial-gradient(circle at 0 0, rgba(255, 255, 255, 0.36), transparent 60%);
            mix-blend-mode: screen;
            pointer-events: none;
        }

        .balance-card {
            margin: 0 0 8px;
            padding: 10px 14px;
            border-radius: 18px;
            border: 1px solid var(--glass-border-soft);
            background:
                linear-gradient(145deg, rgba(255, 255, 255, 0.16), rgba(255, 255, 255, 0.02)),
                rgba(9, 12, 34, 0.86);
            box-shadow:
                0 16px 38px rgba(0, 0, 0, 0.78),
                0 0 0 1px rgba(4, 7, 24, 0.96);
            backdrop-filter: blur(22px) saturate(160%);
            -webkit-backdrop-filter: blur(22px) saturate(160%);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .balance-card::after {
            content: "";
            position: absolute;
            inset: 0;
            border-radius: inherit;
            background: radial-gradient(circle at 12% 0, rgba(255, 255, 255, 0.28), transparent 55%);
            mix-blend-mode: screen;
            pointer-events: none;
        }

        .balance-main-value {
            font-size: 22px;
            font-weight: 800;
        }

        .balance-sub {
            font-size: 11px;
            color: var(--text-muted);
        }

        .balance-badges {
            display: flex;
            gap: 4px;
            font-size: 11px;
            color: var(--accent-soft);
            opacity: 0.9;
        }

        .balance-pill {
            padding: 3px 9px;
            border-radius: 999px;
            border: 1px solid rgba(176, 196, 255, 0.75);
            background: rgba(7, 10, 32, 0.95);
            display: inline-flex;
            align-items: center;
            gap: 6px;
            backdrop-filter: blur(14px);
            -webkit-backdrop-filter: blur(14px);
        }

        /* COIN */
        .home-coin-wrap {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 18px;
        }

        .coin-wrapper {
            position: relative;
            width: 220px;
            height: 220px;
        }

        .coin-shadow {
            position: absolute;
            inset: 42px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(0, 0, 0, 0.95), rgba(0, 0, 0, 0.0));
            filter: blur(18px);
            opacity: 0.9;
            transform: translateY(22px);
            z-index: 0;
        }

        .coin {
            position: relative;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            padding: 0;
            cursor: pointer;
            border: 1px solid rgba(214, 235, 255, 0.75);
            background:
                radial-gradient(circle at 20% 15%, rgba(255, 255, 255, 0.95), rgba(205, 231, 255, 0.7) 24%, rgba(120, 185, 255, 0.8) 44%, rgba(33, 86, 170, 0.95) 70%, rgba(3, 9, 34, 1) 100%);
            box-shadow:
                0 0 0 1px rgba(255, 255, 255, 0.16),
                0 26px 46px rgba(0, 0, 0, 0.9),
                inset 0 10px 24px rgba(255, 255, 255, 0.36),
                inset 0 -22px 28px rgba(1, 4, 18, 0.95);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.12s ease-out, box-shadow 0.12s ease-out;
            overflow: hidden;
            z-index: 1;
            backdrop-filter: blur(26px) saturate(180%);
            -webkit-backdrop-filter: blur(26px) saturate(180%);
        }

        .coin::before {
            content: "";
            position: absolute;
            inset: 16px;
            border-radius: 50%;
            border: 1px solid rgba(240, 248, 255, 0.8);
            background:
                radial-gradient(circle at 25% 18%, rgba(255, 255, 255, 0.95), rgba(215, 235, 255, 0.65) 25%, rgba(140, 195, 255, 0.8) 52%, rgba(32, 82, 169, 0.98) 74%, rgba(3, 9, 34, 1) 100%);
            box-shadow:
                inset 0 14px 26px rgba(255, 255, 255, 0.42),
                inset 0 -24px 32px rgba(0, 0, 0, 0.96);
        }

        .coin::after {
            content: "";
            position: absolute;
            inset: 0;
            border-radius: 50%;
            background:
                radial-gradient(circle at 18% 8%, rgba(255, 255, 255, 0.48), transparent 58%),
                radial-gradient(circle at 75% 90%, rgba(0, 10, 40, 0.75), transparent 60%);
            mix-blend-mode: screen;
            opacity: 0.95;
            pointer-events: none;
        }

        .coin-inner {
            position: relative;
            z-index: 2;
            display: flex;
            align-items: center;
            justify-content: center;
            transform: translateY(7px);
            text-shadow: 0 16px 24px rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
        }

        /* ТЫ СЮДА ВСТАВИШЬ СВОЙ ЛОГО/БУКВУ */
        .coin-letter {
            font-size: 108px;
            font-weight: 900;
            letter-spacing: 0.03em;
            color: rgba(229, 242, 255, 0.98);
            text-shadow:
                0 0 18px rgba(184, 216, 255, 0.95),
                0 14px 22px rgba(0, 0, 0, 0.98);
            filter: drop-shadow(0 7px 10px rgba(0, 0, 0, 0.95));
        }

        .coin.pressed {
            transform: scale(0.94) translateY(4px);
            box-shadow:
                0 0 0 1px rgba(255, 255, 255, 0.18),
                0 14px 26px rgba(0, 0, 0, 0.98),
                inset 0 12px 18px rgba(255, 255, 255, 0.46),
                inset 0 -24px 32px rgba(0, 0, 0, 1);
        }

        .coin-info {
            margin-top: 18px;
            text-align: center;
            font-size: 13px;
            color: var(--text-muted);
        }

        .coin-info span.value {
            display: block;
            font-size: 18px;
            font-weight: 700;
            color: var(--accent-soft);
        }

        /* FLOATING TEXT (+0.1) */
        .floating-text {
            position: fixed;
            font-size: 16px;
            font-weight: 700;
            color: #f9fafb;
            pointer-events: none;
            text-shadow: 0 0 8px rgba(0, 0, 0, 0.7);
            animation: floatUp 800ms ease-out forwards;
            z-index: 999;
        }

        .floating-text small {
            font-size: 11px;
            margin-left: 2px;
            opacity: 0.8;
        }

        @keyframes floatUp {
            0% {
                transform: translate(-50%, 0) scale(0.9);
                opacity: 1;
            }
            60% {
                transform: translate(-50%, -28px) scale(1.02);
                opacity: 0.9;
            }
            100% {
                transform: translate(-50%, -52px) scale(0.96);
                opacity: 0;
            }
        }

        /* NAVIGATION – TELEGRAM STYLE (LIQUID GLASS) */
        .bottom-nav {
            position: fixed;
            left: 0;
            bottom: 8px;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
            pointer-events: none;
        }

        .nav-inner {
            pointer-events: auto;
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px;
            border-radius: 999px;
            background:
                linear-gradient(135deg, rgba(255, 255, 255, 0.16), rgba(255, 255, 255, 0.02)),
                rgba(7, 8, 24, 0.88);
            border: 1px solid rgba(255, 255, 255, 0.26);
            box-shadow:
                0 18px 38px rgba(0, 0, 0, 0.95),
                0 0 0 1px rgba(1, 4, 16, 0.96);
            backdrop-filter: blur(28px) saturate(170%);
            -webkit-backdrop-filter: blur(28px) saturate(170%);
            position: relative;
        }

        .nav-inner::after {
            content: "";
            position: absolute;
            inset: 0;
            border-radius: inherit;
            background: radial-gradient(circle at 10% 0, rgba(255, 255, 255, 0.3), transparent 70%);
            mix-blend-mode: screen;
            pointer-events: none;
        }

        .nav-item {
            position: relative;
            min-width: 82px;
            padding: 8px 14px;
            border-radius: 999px;
            text-align: center;
            font-size: 13px;
            color: var(--text-muted);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            transition: color 0.2s ease-out, transform 0.15s ease-out;
            z-index: 2;
        }

        .nav-item-icon {
            width: 22px;
            height: 22px;
            border-radius: 50%;
            border: 1px solid rgba(148, 163, 253, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 13px;
            background: radial-gradient(circle at 30% 20%, rgba(148, 163, 253, 0.45), rgba(15, 23, 42, 0.9));
            overflow: hidden;
        }

        /* ТЫ СЮДА ПОДСТАВИШЬ СВОИ ИКОНКИ (SVG / IMG / BG-IMAGE) */
        .icon-home {}
        .icon-tasks {}
        .icon-leader {}
        .icon-upgrades {}

        .nav-item.active {
            color: #eef3ff;
            transform: translateY(-1px);
        }

        .nav-item.active .nav-item-icon {
            border-color: var(--accent-soft);
            box-shadow: 0 0 18px rgba(93, 148, 255, 0.9);
        }

        .nav-highlight {
            position: absolute;
            height: 40px;
            border-radius: 999px;
            background:
                radial-gradient(circle at 0 0, rgba(255, 255, 255, 0.28), rgba(102, 158, 255, 0.32));
            box-shadow:
                0 12px 26px rgba(0, 0, 0, 0.9),
                0 0 0 1px rgba(255, 255, 255, 0.16);
            backdrop-filter: blur(28px) saturate(180%);
            -webkit-backdrop-filter: blur(28px) saturate(180%);
            transition: transform 0.26s cubic-bezier(0.22, 0.61, 0.36, 1), width 0.22s ease-out;
            z-index: 1;
        }

        /* TASKS */
        .tasks-banner {
            position: relative;
            width: 100%;
            margin-top: 4px;
            margin-bottom: 10px;
            padding: 16px 16px;
            border-radius: 20px;
            background:
                linear-gradient(145deg, rgba(59, 130, 246, 0.8), rgba(15, 23, 42, 0.96));
            box-shadow:
                0 18px 34px rgba(0, 0, 0, 0.9),
                0 0 0 1px rgba(15, 23, 42, 1);
            backdrop-filter: blur(22px) saturate(170%);
            -webkit-backdrop-filter: blur(22px) saturate(170%);
            font-size: 21px;
            font-weight: 700;
        }

        .tasks-banner::after {
            content: "";
            position: absolute;
            inset: 0;
            border-radius: inherit;
            background: radial-gradient(circle at 10% 0, rgba(255, 255, 255, 0.32), transparent 60%);
            mix-blend-mode: screen;
            pointer-events: none;
        }

        .task-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 16px;
        }

        .task-card {
            position: relative;
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 10px 10px 12px;
            border-radius: 16px;
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.12), rgba(255, 255, 255, 0.02));
            background-color: rgba(12, 16, 40, 0.9);
            border: 1px solid var(--glass-border-soft);
            box-shadow: 0 10px 24px rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(22px) saturate(160%);
            -webkit-backdrop-filter: blur(22px) saturate(160%);
            animation: fadeUpSoft 260ms ease-out;
        }

        .task-card::after {
            content: "";
            position: absolute;
            inset: 0;
            border-radius: inherit;
            background: radial-gradient(circle at 16% 0, rgba(255, 255, 255, 0.2), transparent 60%);
            mix-blend-mode: screen;
            pointer-events: none;
        }

        @keyframes fadeUpSoft {
            from {
                opacity: 0;
                transform: translateY(8px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .task-icon {
            width: 38px;
            height: 38px;
            border-radius: 14px;
            background: radial-gradient(circle at 20% 0, #60a5fa, #1d4ed8);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            overflow: hidden;
        }

        /* ТЫ СЮДА ПОДСТАВИШЬ ИКОНКИ ЗАДАНИЙ */
        .task-icon-inner {}

        .task-body {
            flex: 1;
            min-width: 0;
        }

        .task-title {
            font-size: 14px;
            font-weight: 600;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .task-reward {
            font-size: 12px;
            color: #facc15;
            margin-top: 3px;
        }

        .task-boost {
            font-size: 11px;
            color: var(--text-muted);
        }

        .task-btn {
            border: none;
            border-radius: 999px;
            padding: 7px 12px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            white-space: nowrap;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            transition: transform 0.12s ease-out, box-shadow 0.12s ease-out, background 0.12s;
            position: relative;
            z-index: 2;
        }

        .task-btn-start {
            background: linear-gradient(135deg, #3b82f6, #6366f1);
            color: #f9fafb;
            box-shadow: 0 8px 16px rgba(37, 99, 235, 0.7);
        }

        .task-btn-start:active {
            transform: translateY(1px) scale(0.97);
            box-shadow: 0 3px 8px rgba(37, 99, 235, 0.8);
        }

        .task-btn-done {
            background: #16a34a;
            color: #f9fafb;
            box-shadow: 0 0 0 1px rgba(22, 163, 74, 0.6);
        }

        .task-btn-progress {
            background: #4b5563;
            color: #e5e7eb;
            box-shadow: 0 0 0 1px rgba(75, 85, 99, 0.7);
        }

        /* LEADERBOARD */
        .leader-header {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 10px;
        }

        .you-card {
            position: relative;
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            border-radius: 16px;
            background:
                linear-gradient(135deg, rgba(59, 130, 246, 0.7), rgba(15, 23, 42, 0.98));
            border: 1px solid rgba(129, 140, 248, 0.9);
            box-shadow:
                0 16px 32px rgba(15, 23, 42, 0.98),
                0 0 0 1px rgba(15, 23, 42, 1);
            backdrop-filter: blur(24px) saturate(170%);
            -webkit-backdrop-filter: blur(24px) saturate(170%);
        }

        .you-card::after {
            content: "";
            position: absolute;
            inset: 0;
            border-radius: inherit;
            background: radial-gradient(circle at 12% 0, rgba(255, 255, 255, 0.32), transparent 60%);
            mix-blend-mode: screen;
            pointer-events: none;
        }

        .avatar {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: radial-gradient(circle at 20% 10%, #60a5fa, #1d4ed8);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: #f9fafb;
            font-size: 16px;
            flex-shrink: 0;
            overflow: hidden;
        }

        .avatar.small {
            width: 32px;
            height: 32px;
            font-size: 13px;
        }

        /* ТЫ СЮДА ПОДСТАВИШЬ АВАТАРКУ ПОЛЬЗОВАТЕЛЯ (IMG/SVG) */
        .avatar-inner {}

        .you-info-main {
            flex: 1;
            min-width: 0;
        }

        .you-name {
            font-size: 15px;
            font-weight: 700;
        }

        .you-rank {
            font-size: 11px;
            color: #c4dbff;
        }

        .you-score {
            font-size: 14px;
            font-weight: 700;
        }

        .you-score-sub {
            font-size: 11px;
            color: rgba(226, 232, 240, 0.8);
        }

        .leader-list {
            display: flex;
            flex-direction: column;
            gap: 6px;
            margin-bottom: 16px;
        }

        .leader-row {
            position: relative;
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 10px;
            border-radius: 12px;
            background:
                linear-gradient(135deg, rgba(255, 255, 255, 0.12), rgba(255, 255, 255, 0.02));
            background-color: rgba(12, 16, 40, 0.96);
            border: 1px solid rgba(30, 41, 59, 0.9);
            backdrop-filter: blur(18px) saturate(150%);
            -webkit-backdrop-filter: blur(18px) saturate(150%);
        }

        .leader-row::after {
            content: "";
            position: absolute;
            inset: 0;
            border-radius: inherit;
            background: radial-gradient(circle at 12% 0, rgba(255, 255, 255, 0.16), transparent 60%);
            mix-blend-mode: screen;
            pointer-events: none;
        }

        .leader-rank {
            width: 20px;
            text-align: center;
            font-size: 12px;
            color: var(--text-muted);
            flex-shrink: 0;
        }

        .leader-body {
            flex: 1;
            min-width: 0;
        }

        .leader-name {
            font-size: 13px;
            font-weight: 600;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .leader-score {
            font-size: 12px;
            color: #facc15;
        }

        .leader-prize {
            width: 34px;
            height: 34px;
            border-radius: 12px;
            background: radial-gradient(circle at 20% 0, rgba(148, 163, 253, 0.8), rgba(15, 23, 42, 1));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            color: rgba(249, 250, 251, 0.9);
            overflow: hidden;
            flex-shrink: 0;
        }

        /* ТЫ СЮДА ПОДСТАВИШЬ ИКОНКИ ПРИЗОВ */
        .leader-prize-inner {}

        .leader-row.me {
            border-color: rgba(59, 130, 246, 0.9);
            box-shadow: 0 0 0 1px rgba(59, 130, 246, 0.7);
        }

        /* UPGRADES */
        .upgrades-summary {
            position: relative;
            margin-top: 4px;
            margin-bottom: 12px;
            padding: 10px 12px;
            border-radius: 16px;
            background:
                linear-gradient(135deg, rgba(34, 197, 94, 0.34), rgba(15, 23, 42, 0.98));
            border: 1px solid rgba(22, 163, 74, 0.9);
            box-shadow:
                0 14px 26px rgba(15, 23, 42, 0.98),
                0 0 0 1px rgba(15, 23, 42, 1);
            backdrop-filter: blur(22px) saturate(160%);
            -webkit-backdrop-filter: blur(22px) saturate(160%);
            font-size: 13px;
        }

        .upgrades-summary::after {
            content: "";
            position: absolute;
            inset: 0;
            border-radius: inherit;
            background: radial-gradient(circle at 16% 0, rgba(255, 255, 255, 0.32), transparent 60%);
            mix-blend-mode: screen;
            pointer-events: none;
        }

        .upgrades-summary-main {
            font-size: 16px;
            font-weight: 700;
        }

        .upgrade-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .upgrade-card {
            position: relative;
            padding: 10px 12px;
            border-radius: 16px;
            background:
                linear-gradient(135deg, rgba(255, 255, 255, 0.12), rgba(255, 255, 255, 0.02));
            background-color: rgba(12, 16, 40, 0.96);
            border: 1px solid var(--glass-border-soft);
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 8px 18px rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(20px) saturate(150%);
            -webkit-backdrop-filter: blur(20px) saturate(150%);
        }

        .upgrade-card::after {
            content: "";
            position: absolute;
            inset: 0;
            border-radius: inherit;
            background: radial-gradient(circle at 12% 0, rgba(255, 255, 255, 0.22), transparent 60%);
            mix-blend-mode: screen;
            pointer-events: none;
        }

        .upgrade-icon {
            width: 40px;
            height: 40px;
            border-radius: 14px;
            background: radial-gradient(circle at 20% 0, #22c55e, #15803d);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            flex-shrink: 0;
            overflow: hidden;
        }

        /* ТЫ СЮДА ПОДСТАВИШЬ ИКОНКУ АПГРЕЙДА */
        .upgrade-icon-inner {}

        .upgrade-body {
            flex: 1;
            min-width: 0;
        }

        .upgrade-title {
            font-size: 14px;
            font-weight: 600;
        }

        .upgrade-details {
            font-size: 11px;
            color: var(--text-muted);
            margin-top: 3px;
        }

        .upgrade-price {
            font-size: 12px;
            color: #facc15;
            margin-top: 2px;
        }

        .btn-upgrade {
            border: none;
            border-radius: 999px;
            padding: 7px 12px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            white-space: nowrap;
            background: linear-gradient(135deg, #22c55e, #4ade80);
            color: #022c22;
            box-shadow: 0 8px 16px rgba(34, 197, 94, 0.7);
            transition: transform 0.12s ease-out, box-shadow 0.12s ease-out;
            position: relative;
            z-index: 2;
        }

        .btn-upgrade:active {
            transform: translateY(1px) scale(0.97);
            box-shadow: 0 3px 8px rgba(22, 163, 74, 0.85);
        }

        .btn-upgrade.disabled {
            opacity: 0.45;
            cursor: default;
            box-shadow: none;
        }

        /* TOAST */
        .toast {
            position: fixed;
            bottom: 96px;
            left: 50%;
            transform: translateX(-50%) translateY(40px);
            background: rgba(12, 16, 40, 0.98);
            color: #e5e7eb;
            border-radius: 999px;
            padding: 8px 14px;
            font-size: 12px;
            border: 1px solid rgba(148, 163, 253, 0.5);
            box-shadow: 0 18px 36px rgba(0, 0, 0, 0.95);
            opacity: 0;
            pointer-events: none;
            z-index: 1000;
            backdrop-filter: blur(18px) saturate(150%);
            -webkit-backdrop-filter: blur(18px) saturate(150%);
        }

        .toast.show {
            animation: toastInOut 2.1s ease-out forwards;
        }

        @keyframes toastInOut {
            0% {
                opacity: 0;
                transform: translateX(-50%) translateY(40px);
            }
            14% {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
            86% {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
            100% {
                opacity: 0;
                transform: translateX(-50%) translateY(24px);
            }
        }

        /* HIDE SCROLLBAR (контент скроллится) */
        .tab-page::-webkit-scrollbar {
            width: 0;
            height: 0;
        }
    </style>
</head>
<body>
<canvas id="snowCanvas"></canvas>

<div id="app">
    <!-- HOME -->
    <div id="tab-home" class="tab-page active">
        <div class="top-banner glass-card">
            ПРИЗЫ ТОП ПОЛЬЗОВАТЕЛЯМ
        </div>

        <div class="balance-card">
            <div>
                <div class="balance-sub">Ваш баланс</div>
                <div class="balance-main-value" id="balanceText">0.0</div>
            </div>
            <div style="text-align:right;">
                <div class="balance-sub">За один тап</div>
                <div class="balance-main-value" style="font-size:16px;" id="tapValueText">0.1</div>
                <div class="balance-badges">
                    <span class="balance-pill">
                        <span>⚡</span> <span id="upgradeLevelText">x1.0</span>
                    </span>
                </div>
            </div>
        </div>

        <div class="home-coin-wrap">
            <div class="coin-wrapper">
                <div class="coin-shadow"></div>
                <button class="coin" id="coinButton">
                    <div class="coin-inner">
                        <!-- ТУТ ТЫ СТАВИШЬ СВОЮ БУКВУ/ЛОГО -->
                        <span class="coin-letter">V</span>
                    </div>
                </button>
            </div>
            <div class="coin-info">
                <span class="value">Тапните по монете</span>
                зарабатывайте очки и поднимайтесь в топ
            </div>
        </div>
    </div>

    <!-- TASKS -->
    <div id="tab-tasks" class="tab-page">
        <div class="tasks-banner">
            Задания
        </div>
        <div class="section-subtitle">
            Выполняйте простые действия и получайте <b>+0.1</b> к награде за каждый тап.
        </div>
        <div id="tasksList" class="task-list"></div>
    </div>

    <!-- LEADERBOARD -->
    <div id="tab-leaderboard" class="tab-page">
        <div class="section-title">Лидерборд</div>
        <div class="section-subtitle">
            Топ-10 пользователей по балансу очков. Призы для лучших — в правой колонке.
        </div>

        <div class="leader-header">
            <div class="you-card" id="youCard">
                <div class="avatar" id="youAvatar">
                    <div class="avatar-inner">YOU</div>
                </div>
                <div class="you-info-main">
                    <div class="you-name" id="youName">Вы</div>
                    <div class="you-rank" id="youRankText">Место — #1 из 10</div>
                </div>
                <div style="text-align:right;">
                    <div class="you-score" id="youScore">0.0</div>
                    <div class="you-score-sub">Ваш баланс</div>
                </div>
            </div>
        </div>

        <div id="leaderList" class="leader-list"></div>
    </div>

    <!-- UPGRADES -->
    <div id="tab-upgrades" class="tab-page">
        <div class="section-title">Апгрейды</div>
        <div class="upgrades-summary">
            <div class="upgrades-summary-main">
                Текущий тап: <span id="tapSummaryValue">0.1</span> очков
            </div>
            <div>
                Базовое значение: <span id="baseTapValueText">0.1</span>,
                бонусы от заданий: <span id="taskBonusText">0.0</span>,
                множитель: <span id="multiplierText">x1.0</span>.
            </div>
        </div>

        <div class="upgrade-list">
            <div class="upgrade-card">
                <div class="upgrade-icon">
                    <div class="upgrade-icon-inner"></div>
                </div>
                <div class="upgrade-body">
                    <div class="upgrade-title">Мультипликатор тapа</div>
                    <div class="upgrade-details">
                        Каждый уровень увеличивает награду за тап на <b>+20%</b>.
                    </div>
                    <div class="upgrade-price">
                        Уровень: <span id="upgradeLevelLabel">0</span>,
                        Цена следующего: <span id="upgradePriceLabel">10.0</span> очков
                    </div>
                </div>
                <button id="upgradeButton" class="btn-upgrade">Улучшить</button>
            </div>
        </div>
    </div>

    <!-- NAVIGATION (СТЕКЛЯННАЯ, БЕЗ ЭМОДЗИ, ТЫ ВСТАВИШЬ ИКОНКИ) -->
    <div class="bottom-nav">
        <div class="nav-inner" id="navInner">
            <div class="nav-highlight" id="navHighlight"></div>

            <div class="nav-item active" data-tab="home">
                <div class="nav-item-icon icon-home"></div>
                <div>Главная</div>
            </div>
            <div class="nav-item" data-tab="tasks">
                <div class="nav-item-icon icon-tasks"></div>
                <div>Задания</div>
            </div>
            <div class="nav-item" data-tab="leaderboard">
                <div class="nav-item-icon icon-leader"></div>
                <div>Лидерборд</div>
            </div>
            <div class="nav-item" data-tab="upgrades">
                <div class="nav-item-icon icon-upgrades"></div>
                <div>Апгрейды</div>
            </div>
        </div>
    </div>

    <div class="toast" id="toast"></div>
</div>

<script>
    // ---------- CONFIG ----------
    const STORAGE_KEY = "tap_coin_state_v2";
    const LEADERBOARD_URL = "https://yourserver.com/getLeaderboard"; // ЗАМЕНИ НА СВОЙ URL

    const DEFAULT_STATE = {
        balance: 0,
        baseTap: 0.1,
        taskBonus: 0,
        multiplierLevel: 0,
        tasks: {} // id -> status: "idle" | "started" | "completed"
    };

    const TASKS = [
        {
            id: "task_subscribe_channel",
            title: "Подпишитесь на официальный канал",
            rewardBoost: 0.1,
            url: "https://t.me/"
        },
        {
            id: "task_open_market",
            title: "Откройте раздел Маркет",
            rewardBoost: 0.1,
            url: "https://t.me/"
        },
        {
            id: "task_stars_page",
            title: "Откройте страницу Stars",
            rewardBoost: 0.1,
            url: "https://t.me/"
        },
        {
            id: "task_invite_friend",
            title: "Пригласите друга в мини-апп",
            rewardBoost: 0.1,
            url: "https://t.me/"
        }
    ];

    let appState = loadState();
    let activeTab = "home";
    let lastStartedTasks = new Set();

    let leaderboardData = null;
    let leaderboardSyncTimeout = null;

    // ---------- STATE UTILS ----------
    function loadState() {
        try {
            const raw = localStorage.getItem(STORAGE_KEY);
            if (!raw) return { ...DEFAULT_STATE };
            const parsed = JSON.parse(raw);
            return { ...DEFAULT_STATE, ...parsed };
        } catch (e) {
            console.warn("Failed to load state", e);
            return { ...DEFAULT_STATE };
        }
    }

    function saveState() {
        try {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(appState));
        } catch (e) {
            console.warn("Failed to save state", e);
        }
    }

    function getMultiplier() {
        return 1 + appState.multiplierLevel * 0.2;
    }

    function getTapValue() {
        return (appState.baseTap + appState.taskBonus) * getMultiplier();
    }

    function formatPoints(v) {
        return v.toFixed(1);
    }

    function showToast(text) {
        const toast = document.getElementById("toast");
        toast.textContent = text;
        toast.classList.remove("show");
        void toast.offsetWidth;
        toast.classList.add("show");
    }

    // ---------- HAPTIC ----------
    function hapticTap() {
        try {
            if (window.Telegram && Telegram.WebApp && Telegram.WebApp.HapticFeedback) {
                Telegram.WebApp.HapticFeedback.impactOccurred("light");
            } else if (navigator.vibrate) {
                navigator.vibrate(30);
            }
        } catch (e) {}
    }

    // ---------- FLOATING TEXT ----------
    function spawnFloatingText(value, clientX, clientY) {
        const el = document.createElement("div");
        el.className = "floating-text";
        el.innerHTML = "+" + formatPoints(value) + "<small> очк.</small>";
        el.style.left = clientX + "px";
        el.style.top = clientY + "px";
        document.body.appendChild(el);
        el.addEventListener("animationend", () => el.remove());
    }

    // ---------- BALANCE UI ----------
    function refreshBalanceUI() {
        const balanceText = document.getElementById("balanceText");
        const tapValueText = document.getElementById("tapValueText");
        const upgradeLevelText = document.getElementById("upgradeLevelText");
        const tapSummaryValue = document.getElementById("tapSummaryValue");
        const baseTapValueText = document.getElementById("baseTapValueText");
        const taskBonusText = document.getElementById("taskBonusText");
        const multiplierText = document.getElementById("multiplierText");

        const tap = getTapValue();
        balanceText.textContent = formatPoints(appState.balance);
        tapValueText.textContent = formatPoints(tap);
        if (tapSummaryValue) tapSummaryValue.textContent = formatPoints(tap);
        if (baseTapValueText) baseTapValueText.textContent = formatPoints(appState.baseTap);
        if (taskBonusText) taskBonusText.textContent = formatPoints(appState.taskBonus);
        if (multiplierText) multiplierText.textContent = "x" + getMultiplier().toFixed(1);
        if (upgradeLevelText) upgradeLevelText.textContent = "x" + getMultiplier().toFixed(1);

        scheduleLeaderboardSync();
    }

    // ---------- COIN ----------
    (function setupCoin() {
        const coinBtn = document.getElementById("coinButton");

        function press() {
            coinBtn.classList.add("pressed");
        }

        function release(ev) {
            if (!coinBtn.classList.contains("pressed")) return;
            coinBtn.classList.remove("pressed");
            const rect = coinBtn.getBoundingClientRect();
            const x = ev ? ev.clientX : rect.left + rect.width / 2;
            const y = ev ? ev.clientY : rect.top + rect.height / 2;
            doTap(x, y);
        }

        function cancel() {
            coinBtn.classList.remove("pressed");
        }

        coinBtn.addEventListener("pointerdown", (e) => {
            e.preventDefault();
            coinBtn.setPointerCapture(e.pointerId);
            press();
        });

        coinBtn.addEventListener("pointerup", (e) => {
            e.preventDefault();
            coinBtn.releasePointerCapture(e.pointerId);
            release(e);
        });

        coinBtn.addEventListener("pointercancel", (e) => {
            e.preventDefault();
            coinBtn.releasePointerCapture(e.pointerId);
            cancel();
        });
    })();

    function doTap(x, y) {
        const value = getTapValue();
        appState.balance += value;
        saveState();
        refreshBalanceUI();
        updateYouCard();
        updateLeaderboardUI();
        hapticTap();
        spawnFloatingText(value, x, y);
    }

    // ---------- TASKS ----------
    function renderTasks() {
        const container = document.getElementById("tasksList");
        if (!container) return;
        container.innerHTML = "";
        TASKS.forEach(task => {
            const state = appState.tasks[task.id] || "idle";
            const card = document.createElement("div");
            card.className = "task-card";

            const icon = document.createElement("div");
            icon.className = "task-icon";
            const iconInner = document.createElement("div");
            iconInner.className = "task-icon-inner";
            icon.appendChild(iconInner);

            const body = document.createElement("div");
            body.className = "task-body";

            const title = document.createElement("div");
            title.className = "task-title";
            title.textContent = task.title;

            const reward = document.createElement("div");
            reward.className = "task-reward";
            reward.textContent = "+0.1 к награде за тап";

            const boost = document.createElement("div");
            boost.className = "task-boost";
            boost.textContent = "Откройте ссылку и вернитесь в мини-апп";

            body.appendChild(title);
            body.appendChild(reward);
            body.appendChild(boost);

            const btn = document.createElement("button");
            btn.className = "task-btn";

            if (state === "completed") {
                btn.classList.add("task-btn-done");
                btn.textContent = "Получено ✓";
                btn.disabled = true;
            } else if (state === "started") {
                btn.classList.add("task-btn-progress");
                btn.textContent = "Выполняется…";
                btn.disabled = true;
            } else {
                btn.classList.add("task-btn-start");
                btn.textContent = "Начать";
                btn.addEventListener("click", () => startTask(task));
            }

            card.appendChild(icon);
            card.appendChild(body);
            card.appendChild(btn);
            container.appendChild(card);
        });
    }

    function startTask(task) {
        appState.tasks[task.id] = "started";
        lastStartedTasks.add(task.id);
        saveState();
        renderTasks();

        window.open(task.url, "_blank");

        showToast("Выполните действие и вернитесь в мини-апп — задание засчитается автоматически.");
    }

    function completeTask(taskId) {
        const prev = appState.tasks[taskId];
        if (prev === "completed") return;

        appState.tasks[taskId] = "completed";
        appState.taskBonus += 0.1;
        saveState();
        refreshBalanceUI();
        renderTasks();
        showToast("Задание выполнено! Награда за тап увеличена на +0.1.");
    }

    function handleReturnFromTasks() {
        let anyCompleted = false;
        for (const id of Object.keys(appState.tasks)) {
            if (appState.tasks[id] === "started") {
                completeTask(id);
                anyCompleted = true;
            }
        }
        if (anyCompleted) {
            lastStartedTasks.clear();
        }
    }

    window.addEventListener("focus", handleReturnFromTasks);
    document.addEventListener("visibilitychange", () => {
        if (document.visibilityState === "visible") {
            handleReturnFromTasks();
        }
    });

    // ---------- TELEGRAM USER ----------
    function getTelegramUser() {
        try {
            if (window.Telegram && Telegram.WebApp && Telegram.WebApp.initDataUnsafe && Telegram.WebApp.initDataUnsafe.user) {
                return Telegram.WebApp.initDataUnsafe.user;
            }
        } catch (e) {}
        return null;
    }

    function getInitData() {
        try {
            if (window.Telegram && Telegram.WebApp) {
                return Telegram.WebApp.initData || "";
            }
        } catch (e) {}
        return "";
    }

    function initialsFromName(name) {
        if (!name) return "YOU";
        const parts = name.split(/[\s_]+/).filter(Boolean);
        if (parts.length === 1) return parts[0].slice(0, 2).toUpperCase();
        return (parts[0][0] + parts[1][0]).toUpperCase();
    }

    // ---------- REAL LEADERBOARD SYNC ----------
    function scheduleLeaderboardSync() {
        if (leaderboardSyncTimeout) clearTimeout(leaderboardSyncTimeout);
        leaderboardSyncTimeout = setTimeout(syncLeaderboardWithServer, 800);
    }

    async function syncLeaderboardWithServer() {
        const initData = getInitData();
        if (!LEADERBOARD_URL) return;

        try {
            const res = await fetch(LEADERBOARD_URL, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    initData,
                    balance: appState.balance
                })
            });

            if (!res.ok) throw new Error("HTTP " + res.status);
            const data = await res.json();
            // Ожидаемый формат:
            // { you: { username, score, rank, total }, top: [ { username, score }, ... ] }
            leaderboardData = data;
            updateYouCard();
            updateLeaderboardUI();
        } catch (e) {
            console.warn("Leaderboard sync error:", e);
            // Если сервер не отвечает — просто используем локальный стейт без ошибок
        }
    }

    // ---------- LEADERBOARD UI ----------
    function updateYouCard() {
        const youNameEl = document.getElementById("youName");
        const youScoreEl = document.getElementById("youScore");
        const youRankTextEl = document.getElementById("youRankText");
        const youAvatarEl = document.getElementById("youAvatar");

        const tgUser = getTelegramUser();
        const fallbackName = "Вы";
        const rawName = tgUser
            ? (tgUser.username || (tgUser.first_name + (tgUser.last_name ? " " + tgUser.last_name : "")))
            : fallbackName;

        const usernameForDisplay = tgUser
            ? ("@" + (tgUser.username || rawName))
            : fallbackName;

        const initials = initialsFromName(rawName);

        if (youNameEl) youNameEl.textContent = usernameForDisplay;
        if (youScoreEl) youScoreEl.textContent = formatPoints(appState.balance) + " ★";

        if (youAvatarEl) {
            youAvatarEl.innerHTML = "";
            const inner = document.createElement("div");
            inner.className = "avatar-inner";
            inner.textContent = initials;
            youAvatarEl.appendChild(inner);
        }

        if (leaderboardData && leaderboardData.you) {
            const y = leaderboardData.you;
            const rank = y.rank ?? "—";
            const total = y.total ?? "—";
            if (youRankTextEl) youRankTextEl.textContent = `Место — #${rank} из ${total}`;
        } else {
            if (youRankTextEl) youRankTextEl.textContent = "Место — —";
        }
    }

    function updateLeaderboardUI() {
        const container = document.getElementById("leaderList");
        if (!container) return;
        container.innerHTML = "";

        let list = [];
        if (leaderboardData && Array.isArray(leaderboardData.top)) {
            list = leaderboardData.top;
        } else {
            // запасной локальный вариант, если сервера нет
            const tgUser = getTelegramUser();
            const fallbackName = "Вы";
            const rawName = tgUser
                ? (tgUser.username || (tgUser.first_name + (tgUser.last_name ? " " + tgUser.last_name : "")))
                : fallbackName;

            const staticPlayers = [
                { username: "aaqxn", score: 57600 },
                { username: "muveonton", score: 50800 },
                { username: "michael_sailor", score: 45700 },
                { username: "theflipper", score: 24200 },
                { username: "usluip", score: 20200 },
                { username: "meteora_fa", score: 20100 },
                { username: "denis33371", score: 18400 },
                { username: "crypto_whale", score: 15200 },
                { username: "tap_master", score: 11600 }
            ];

            const players = staticPlayers.map(p => ({ ...p }));
            players.push({ username: rawName, score: appState.balance });
            players.sort((a, b) => b.score - a.score);
            list = players.slice(0, 10);
        }

        const tgUser = getTelegramUser();
        const currentName = tgUser
            ? (tgUser.username || (tgUser.first_name + (tgUser.last_name ? " " + tgUser.last_name : "")))
            : "Вы";

        list.forEach((p, idx) => {
            const row = document.createElement("div");
            const isMe = p.is_you === true || (p.username === currentName);
            row.className = "leader-row" + (isMe ? " me" : "");

            const rank = document.createElement("div");
            rank.className = "leader-rank";
            rank.textContent = idx + 1;

            const avatar = document.createElement("div");
            avatar.className = "avatar small";
            const avatarInner = document.createElement("div");
            avatarInner.className = "avatar-inner";
            avatarInner.textContent = initialsFromName(p.username || ("#" + (idx + 1)));
            avatar.appendChild(avatarInner);

            const body = document.createElement("div");
            body.className = "leader-body";

            const uname = document.createElement("div");
            uname.className = "leader-name";
            uname.textContent = p.username || ("Игрок " + (idx + 1));

            const score = document.createElement("div");
            score.className = "leader-score";
            const valNum = Number(p.score || 0);
            const val = valNum >= 1000 ? (valNum / 1000).toFixed(1) + "k" : formatPoints(valNum);
            score.textContent = val + " ★";

            body.appendChild(uname);
            body.appendChild(score);

            const prize = document.createElement("div");
            prize.className = "leader-prize";
            const prizeInner = document.createElement("div");
            prizeInner.className = "leader-prize-inner";
            // ТУТ ТЫ ВСТАВИШЬ СВОИ ПРИЗЫ (ИКОНКИ/PNG)
            prize.appendChild(prizeInner);

            row.appendChild(rank);
            row.appendChild(avatar);
            row.appendChild(body);
            row.appendChild(prize);

            container.appendChild(row);
        });
    }

    // ---------- UPGRADES ----------
    function getUpgradePrice(level) {
        return 10 * Math.pow(level + 1, 2);
    }

    function refreshUpgradesUI() {
        const btn = document.getElementById("upgradeButton");
        const levelLabel = document.getElementById("upgradeLevelLabel");
        const priceLabel = document.getElementById("upgradePriceLabel");

        if (!btn || !levelLabel || !priceLabel) return;

        const price = getUpgradePrice(appState.multiplierLevel);
        levelLabel.textContent = appState.multiplierLevel;
        priceLabel.textContent = formatPoints(price);

        if (appState.balance >= price) {
            btn.classList.remove("disabled");
            btn.disabled = false;
        } else {
            btn.classList.add("disabled");
            btn.disabled = false; // пусть нажимает, покажем тост
        }

        refreshBalanceUI();
    }

    (function setupUpgradeButton() {
        const btn = document.getElementById("upgradeButton");
        if (!btn) return;
        btn.addEventListener("click", () => {
            const price = getUpgradePrice(appState.multiplierLevel);
            if (appState.balance < price) {
                showToast("Недостаточно очков для апгрейда.");
                return;
            }
            appState.balance -= price;
            appState.multiplierLevel += 1;
            saveState();
            showToast("Мультипликатор повышен! Теперь +" + (getMultiplier() - 1).toFixed(1) + " к базовому значению.");
            refreshUpgradesUI();
            updateYouCard();
            updateLeaderboardUI();
        });
    })();

    // ---------- NAVIGATION ----------
    (function setupNavigation() {
        const tabs = document.querySelectorAll(".nav-item");
        const highlight = document.getElementById("navHighlight");
        const navInner = document.getElementById("navInner");

        function updateHighlight() {
            const active = document.querySelector(".nav-item.active");
            if (!active || !highlight || !navInner) return;
            const rect = active.getBoundingClientRect();
            const parentRect = navInner.getBoundingClientRect();
            const width = rect.width;
            const offset = rect.left - parentRect.left;
            highlight.style.width = width + "px";
            highlight.style.transform = "translateX(" + offset + "px)";
        }

        function switchTab(tabId) {
            activeTab = tabId;

            document.querySelectorAll(".tab-page").forEach(page => {
                page.classList.toggle("active", page.id === "tab-" + tabId);
            });

            tabs.forEach(item => {
                item.classList.toggle("active", item.dataset.tab === tabId);
            });

            updateHighlight();

            if (tabId === "leaderboard") {
                updateYouCard();
                updateLeaderboardUI();
                scheduleLeaderboardSync();
            }
            if (tabId === "tasks") {
                renderTasks();
            }
            if (tabId === "upgrades") {
                refreshUpgradesUI();
            }
            if (tabId === "home") {
                refreshBalanceUI();
            }
        }

        tabs.forEach(item => {
            item.addEventListener("click", () => {
                const tabId = item.dataset.tab;
                if (tabId !== activeTab) {
                    switchTab(tabId);
                }
            });
        });

        window.addEventListener("resize", updateHighlight);
        setTimeout(updateHighlight, 60);
    })();

    // ---------- SNOW (iOS Weather "Snowfall" style) ----------
    (function setupSnow() {
        const canvas = document.getElementById("snowCanvas");
        const ctx = canvas.getContext("2d");

        let width = window.innerWidth;
        let height = window.innerHeight;
        canvas.width = width;
        canvas.height = height;

        window.addEventListener("resize", () => {
            width = window.innerWidth;
            height = window.innerHeight;
            canvas.width = width;
            canvas.height = height;
        });

        const flakes = [];
        const FLAKE_COUNT = 90;

        function initFlakes() {
            flakes.length = 0;
            for (let i = 0; i < FLAKE_COUNT; i++) {
                flakes.push(createFlake(true));
            }
        }

        function createFlake(initial) {
            return {
                x: Math.random() * width,
                y: initial ? Math.random() * height : -10,
                r: 0.5 + Math.random() * 2.2,
                speedY: 0.3 + Math.random() * 0.9,
                driftX: -0.15 + Math.random() * 0.3,
                driftPhase: Math.random() * Math.PI * 2,
                alpha: 0.35 + Math.random() * 0.4
            };
        }

        function update() {
            ctx.clearRect(0, 0, width, height);

            ctx.save();
            ctx.fillStyle = "#fff";
            for (let i = 0; i < flakes.length; i++) {
                const f = flakes[i];
                f.y += f.speedY;
                f.driftPhase += 0.01 + Math.random() * 0.01;
                f.x += f.driftX + Math.sin(f.driftPhase) * 0.1;

                if (f.y > height + 5 || f.x < -10 || f.x > width + 10) {
                    flakes[i] = createFlake(false);
                }

                ctx.globalAlpha = f.alpha;
                ctx.beginPath();
                ctx.arc(f.x, f.y, f.r, 0, Math.PI * 2);
                ctx.fill();
            }
            ctx.restore();

            requestAnimationFrame(update);
        }

        initFlakes();
        requestAnimationFrame(update);
    })();

    // ---------- INIT ----------
    function init() {
        try {
            if (window.Telegram && Telegram.WebApp) {
                Telegram.WebApp.ready();
                Telegram.WebApp.expand();
            }
        } catch (e) {}

        refreshBalanceUI();
        renderTasks();
        updateYouCard();
        updateLeaderboardUI();
        refreshUpgradesUI();
        scheduleLeaderboardSync();
    }

    init();
</script>
</body>
</html>
